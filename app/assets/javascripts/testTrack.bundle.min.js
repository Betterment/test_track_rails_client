!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t=t||self).TestTrack=e(t.$)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}i(function(e,i){!function(t){var e=/\+/g;function i(t){return s.raw?t:encodeURIComponent(t)}function n(t){return i(s.json?JSON.stringify(t):String(t))}function r(i,n){var r=s.raw?i:function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(e," ")),s.json?JSON.parse(t):t}catch(t){}}(i);return t.isFunction(n)?n(r):r}var s=t.cookie=function(e,o,a){if(void 0!==o&&!t.isFunction(o)){if("number"==typeof(a=t.extend({},s.defaults,a)).expires){var u=a.expires,f=a.expires=new Date;f.setTime(+f+864e5*u)}return document.cookie=[i(e),"=",n(o),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}for(var p,h=e?void 0:{},c=document.cookie?document.cookie.split("; "):[],d=0,g=c.length;d<g;d++){var l=c[d].split("="),v=(p=l.shift(),s.raw?p:decodeURIComponent(p)),m=l.join("=");if(e&&e===v){h=r(m,o);break}e||void 0===(m=r(m))||(h[v]=m)}return h};s.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}}(t)});var n=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("variant"))throw new Error("must provide variant");if(!t.hasOwnProperty("isUnsynced"))throw new Error("must provide isUnsynced");this._splitName=t.splitName,this._variant=t.variant,this._context=t.context,this._isUnsynced=t.isUnsynced};n.fromJsonArray=function(t){for(var e=[],i=0;i<t.length;i++)e.push(new n({splitName:t[i].split_name,variant:t[i].variant,context:t[i].context,isUnsynced:t[i].unsynced}));return e},n.prototype.getSplitName=function(){return this._splitName},n.prototype.getVariant=function(){return this._variant},n.prototype.setVariant=function(t){this._variant=t},n.prototype.getContext=function(){return this._context},n.prototype.setContext=function(t){this._context=t},n.prototype.isUnsynced=function(){return this._isUnsynced},n.prototype.setUnsynced=function(t){this._isUnsynced=t};var r=i(function(t,i){!function(n){var r=i,s=t&&t.exports==r&&t,o="object"==typeof e&&e;o.global!==o&&o.window!==o||(n=o);var a=function(t){this.message=t};(a.prototype=new Error).name="InvalidCharacterError";var u=function(t){throw new a(t)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=/[\t\n\f\r ]/g,h={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var e,i,n,r,s=t.length%3,o="",a=-1,p=t.length-s;++a<p;)e=t.charCodeAt(a)<<16,i=t.charCodeAt(++a)<<8,n=t.charCodeAt(++a),o+=f.charAt((r=e+i+n)>>18&63)+f.charAt(r>>12&63)+f.charAt(r>>6&63)+f.charAt(63&r);return 2==s?(e=t.charCodeAt(a)<<8,i=t.charCodeAt(++a),o+=f.charAt((r=e+i)>>10)+f.charAt(r>>4&63)+f.charAt(r<<2&63)+"="):1==s&&(r=t.charCodeAt(a),o+=f.charAt(r>>2)+f.charAt(r<<4&63)+"=="),o},decode:function(t){var e=(t=String(t).replace(p,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9\/]/.test(t))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var i,n,r=0,s="",o=-1;++o<e;)n=f.indexOf(t.charAt(o)),i=r%4?64*i+n:n,r++%4&&(s+=String.fromCharCode(255&i>>(-2*r&6)));return s},version:"0.1.0"};if(r&&!r.nodeType)if(s)s.exports=h;else for(var c in h)h.hasOwnProperty(c)&&(r[c]=h[c]);else n.base64=h}(e)}),s=function(){};s.prototype.getConfig=function(){return"function"==typeof window.atob?JSON.parse(window.atob(window.TT)):JSON.parse(r.decode(window.TT))};var o=function(t,e,i){this._name=t,this._isFeatureGate=e,this._weighting=i};o.prototype.getName=function(){return this._name},o.prototype.isFeatureGate=function(){return this._isFeatureGate},o.prototype.getVariants=function(){return Object.keys(this._weighting)},o.prototype.getWeighting=function(){return this._weighting},o.prototype.hasVariant=function(t){return t in this._weighting};var a=function(t){this._splitArray=t,this._loaded=null!==t};a.prototype.getSplit=function(t){return this.getSplits()[t]},a.prototype.isLoaded=function(){return this._loaded},a.prototype.asV1Hash=function(){var t={};for(var e in this.getSplits()){var i=this._splits[e];t[e]=i.getWeighting()}return t},a.prototype.getSplits=function(){return this._loaded?(this._splits||(this._splits={},this._splitArray.forEach(function(t){this._splits[t.getName()]=t}.bind(this))),this._splits):{}};var u,f,p,h=function(){if(!u){var t=new s;u=t.getConfig()}return u},c=function(){return h().url},d=function(){return h().cookieDomain},g=function(){return h().cookieName||"tt_visitor_id"},l=function(){var t=h().registry;if(!t)return new a(null);if(!p){var e=Object.keys(t).map(function(e){var i=t[e];return new o(e,i.feature_gate,i.weights)});p=new a(e)}return p},v=function(){var t=h().assignments;if(!t)return null;if(!f)for(var e in f=[],t)f.push(new n({splitName:e,variant:t[e],isUnsynced:!1}));return f},m=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,this._username=t.username,this._password=t.password,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment");if(!this._username)throw new Error("must provide username");if(!this._password)throw new Error("must provide password")};function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}m.prototype.persistAssignment=function(){return t.ajax(c()+"/api/v1/assignment_override",{method:"POST",dataType:"json",crossDomain:!0,headers:{Authorization:"Basic "+btoa(this._username+":"+this._password)},data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),variant:this._assignment.getVariant(),context:this._assignment.getContext(),mixpanel_result:"success"}}).fail(function(t,e,i){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,e,i].join(", "))}.bind(this))};var _=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("trueVariant"))throw new Error("must provide trueVariant");if(!t.visitor)throw new Error("must provide visitor");this._splitName=t.splitName,this._trueVariant=t.trueVariant,this._visitor=t.visitor,this._splitRegistry=l()};_.prototype.getVariants=function(){var t=this._getSplitVariants();return t&&t.length>2&&this._visitor.logError("A/B for "+this._splitName+" configures split with more than 2 variants"),{true:this._getTrueVariant(),false:this._getFalseVariant()}},_.prototype._getTrueVariant=function(){return this._trueVariant||!0},_.prototype._getFalseVariant=function(){var t=this._getNonTrueVariants();return!!t&&t.sort()[0]},_.prototype._getNonTrueVariants=function(){var t=this._getSplitVariants();if(t){var e=this._getTrueVariant(),i=t.indexOf(e);return-1!==i&&t.splice(i,1),t}return null},_.prototype._getSplit=function(){return this._splitRegistry.getSplit(this._splitName)},_.prototype._getSplitVariants=function(){return this._getSplit()&&this._getSplit().getVariants()};var w=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment")};w.prototype.send=function(){var e=this._persistAssignment(),i=t.Deferred();return this._visitor.analytics.trackAssignment(this._visitor.getId(),this._assignment,function(t){var e=this._persistAssignment(t?"success":"failure");e.always(function(){"resolved"===e.state()?i.resolve():i.reject()})}.bind(this)),t.when(e,i)},w.prototype._persistAssignment=function(e){return t.ajax(c()+"/api/v1/assignment_event",{method:"POST",dataType:"json",crossDomain:!0,data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),context:this._assignment.getContext(),mixpanel_result:e}}).fail(function(t,e,i){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,e,i].join(", "))}.bind(this))};var V=function(t){if(this.visitorId=t.visitorId,this.identifierType=t.identifierType,this.value=t.value,!this.visitorId)throw new Error("must provide visitorId");if(!this.identifierType)throw new Error("must provide identifierType");if(!this.value)throw new Error("must provide value")};V.prototype.save=function(){var e=t.Deferred();return t.ajax(c()+"/api/v1/identifier",{method:"POST",dataType:"json",crossDomain:!0,data:{identifier_type:this.identifierType,value:this.value,visitor_id:this.visitorId}}).then(function(t){var i=new F({id:t.visitor.id,assignments:n.fromJsonArray(t.visitor.assignments)});e.resolve(i)}),e.promise()};var b=function(){};b.prototype.trackAssignment=function(t,e,i){var n={TTVisitorID:t,SplitName:e.getSplitName(),SplitVariant:e.getVariant(),SplitContext:e.getContext()};window.mixpanel&&window.mixpanel.track("SplitAssigned",n,i)},b.prototype.identify=function(t){window.mixpanel&&window.mixpanel.identify(t)},b.prototype.alias=function(t){window.mixpanel&&window.mixpanel.alias(t)};for(var x=i(function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var i=new Uint8Array(16);t.exports=function(){return e(i),i}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}}),A=[],E=0;E<256;++E)A[E]=(E+256).toString(16).substr(1);var S,N,k=function(t,e){var i=e||0,n=A;return[n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]]].join("")},C=0,T=0;var I=function(t,e,i){var n=e&&i||0,r=e||[],s=(t=t||{}).node||S,o=void 0!==t.clockseq?t.clockseq:N;if(null==s||null==o){var a=x();null==s&&(s=S=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=N=16383&(a[6]<<8|a[7]))}var u=void 0!==t.msecs?t.msecs:(new Date).getTime(),f=void 0!==t.nsecs?t.nsecs:T+1,p=u-C+(f-T)/1e4;if(p<0&&void 0===t.clockseq&&(o=o+1&16383),(p<0||u>C)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");C=u,T=f,N=o;var h=(1e4*(268435455&(u+=122192928e5))+f)%4294967296;r[n++]=h>>>24&255,r[n++]=h>>>16&255,r[n++]=h>>>8&255,r[n++]=255&h;var c=u/4294967296*1e4&268435455;r[n++]=c>>>8&255,r[n++]=255&c,r[n++]=c>>>24&15|16,r[n++]=c>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o;for(var d=0;d<6;++d)r[n+d]=s[d];return e||k(r)};var O=function(t,e,i){var n=e&&i||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var r=(t=t||{}).random||(t.rng||x)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var s=0;s<16;++s)e[n+s]=r[s];return e||k(r)},D=O;D.v1=I,D.v4=O;var U=D,j=i(function(t){!function(e){function i(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function n(t,e,n,r,s,o){return i((a=i(i(e,t),i(r,o)))<<(u=s)|a>>>32-u,n);var a,u}function r(t,e,i,r,s,o,a){return n(e&i|~e&r,t,e,s,o,a)}function s(t,e,i,r,s,o,a){return n(e&r|i&~r,t,e,s,o,a)}function o(t,e,i,r,s,o,a){return n(e^i^r,t,e,s,o,a)}function a(t,e,i,r,s,o,a){return n(i^(e|~r),t,e,s,o,a)}function u(t,e){var n,u,f,p,h;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var c=1732584193,d=-271733879,g=-1732584194,l=271733878;for(n=0;n<t.length;n+=16)u=c,f=d,p=g,h=l,c=r(c,d,g,l,t[n],7,-680876936),l=r(l,c,d,g,t[n+1],12,-389564586),g=r(g,l,c,d,t[n+2],17,606105819),d=r(d,g,l,c,t[n+3],22,-1044525330),c=r(c,d,g,l,t[n+4],7,-176418897),l=r(l,c,d,g,t[n+5],12,1200080426),g=r(g,l,c,d,t[n+6],17,-1473231341),d=r(d,g,l,c,t[n+7],22,-45705983),c=r(c,d,g,l,t[n+8],7,1770035416),l=r(l,c,d,g,t[n+9],12,-1958414417),g=r(g,l,c,d,t[n+10],17,-42063),d=r(d,g,l,c,t[n+11],22,-1990404162),c=r(c,d,g,l,t[n+12],7,1804603682),l=r(l,c,d,g,t[n+13],12,-40341101),g=r(g,l,c,d,t[n+14],17,-1502002290),c=s(c,d=r(d,g,l,c,t[n+15],22,1236535329),g,l,t[n+1],5,-165796510),l=s(l,c,d,g,t[n+6],9,-1069501632),g=s(g,l,c,d,t[n+11],14,643717713),d=s(d,g,l,c,t[n],20,-373897302),c=s(c,d,g,l,t[n+5],5,-701558691),l=s(l,c,d,g,t[n+10],9,38016083),g=s(g,l,c,d,t[n+15],14,-660478335),d=s(d,g,l,c,t[n+4],20,-405537848),c=s(c,d,g,l,t[n+9],5,568446438),l=s(l,c,d,g,t[n+14],9,-1019803690),g=s(g,l,c,d,t[n+3],14,-187363961),d=s(d,g,l,c,t[n+8],20,1163531501),c=s(c,d,g,l,t[n+13],5,-1444681467),l=s(l,c,d,g,t[n+2],9,-51403784),g=s(g,l,c,d,t[n+7],14,1735328473),c=o(c,d=s(d,g,l,c,t[n+12],20,-1926607734),g,l,t[n+5],4,-378558),l=o(l,c,d,g,t[n+8],11,-2022574463),g=o(g,l,c,d,t[n+11],16,1839030562),d=o(d,g,l,c,t[n+14],23,-35309556),c=o(c,d,g,l,t[n+1],4,-1530992060),l=o(l,c,d,g,t[n+4],11,1272893353),g=o(g,l,c,d,t[n+7],16,-155497632),d=o(d,g,l,c,t[n+10],23,-1094730640),c=o(c,d,g,l,t[n+13],4,681279174),l=o(l,c,d,g,t[n],11,-358537222),g=o(g,l,c,d,t[n+3],16,-722521979),d=o(d,g,l,c,t[n+6],23,76029189),c=o(c,d,g,l,t[n+9],4,-640364487),l=o(l,c,d,g,t[n+12],11,-421815835),g=o(g,l,c,d,t[n+15],16,530742520),c=a(c,d=o(d,g,l,c,t[n+2],23,-995338651),g,l,t[n],6,-198630844),l=a(l,c,d,g,t[n+7],10,1126891415),g=a(g,l,c,d,t[n+14],15,-1416354905),d=a(d,g,l,c,t[n+5],21,-57434055),c=a(c,d,g,l,t[n+12],6,1700485571),l=a(l,c,d,g,t[n+3],10,-1894986606),g=a(g,l,c,d,t[n+10],15,-1051523),d=a(d,g,l,c,t[n+1],21,-2054922799),c=a(c,d,g,l,t[n+8],6,1873313359),l=a(l,c,d,g,t[n+15],10,-30611744),g=a(g,l,c,d,t[n+6],15,-1560198380),d=a(d,g,l,c,t[n+13],21,1309151649),c=a(c,d,g,l,t[n+4],6,-145523070),l=a(l,c,d,g,t[n+11],10,-1120210379),g=a(g,l,c,d,t[n+2],15,718787259),d=a(d,g,l,c,t[n+9],21,-343485551),c=i(c,u),d=i(d,f),g=i(g,p),l=i(l,h);return[c,d,g,l]}function f(t){var e,i="",n=32*t.length;for(e=0;e<n;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function p(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var n=8*t.length;for(e=0;e<n;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function h(t){var e,i,n="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),n+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return n}function c(t){return unescape(encodeURIComponent(t))}function d(t){return function(t){return f(u(p(t),8*t.length))}(c(t))}function g(t,e){return function(t,e){var i,n,r=p(t),s=[],o=[];for(s[15]=o[15]=void 0,r.length>16&&(r=u(r,8*t.length)),i=0;i<16;i+=1)s[i]=909522486^r[i],o[i]=1549556828^r[i];return n=u(s.concat(p(e)),512+8*e.length),f(u(o.concat(n),640))}(c(t),c(e))}function l(t,e,i){return e?i?g(e,t):h(g(e,t)):i?d(t):h(d(t))}t.exports?t.exports=l:e.md5=l}(e)}),R=function(t){if(this.visitor=t.visitor,this.splitName=t.splitName,!this.visitor)throw new Error("must provide visitor");if(!this.splitName)throw new Error("must provide splitName")};R.prototype.getVariant=function(){if(!l().isLoaded())return null;for(var t=0,e=this.getAssignmentBucket(),i=this.getWeighting(),n=this.getSortedVariants(),r=0;r<n.length;r++){var s=n[r];if((t+=i[s])>e)return s}throw new Error("Assignment bucket out of range. "+e+" unmatched in "+this.splitName+": "+JSON.stringify(i))},R.prototype.getSplitVisitorHash=function(){return j(this.splitName+this.visitor.getId())},R.prototype.getHashFixnum=function(){return parseInt(this.getSplitVisitorHash().substr(0,8),16)},R.prototype.getAssignmentBucket=function(){return this.getHashFixnum()%100},R.prototype.getSortedVariants=function(){return this.getVariants().sort()},R.prototype.getVariants=function(){return Object.getOwnPropertyNames(this.getWeighting())},R.prototype.getWeighting=function(){var t=l().getSplit(this.splitName);if(!t){var e='Unknown split: "'+this.splitName+'"';throw this.visitor.logError(e),new Error(e)}return t.getWeighting()};var P=function(t){if(!t.assignment)throw new Error("must provide assignment");if(!t.visitor)throw new Error("must provide visitor");this._assignment=t.assignment,this._visitor=t.visitor,this._splitRegistry=l(),this._variantHandlers={}};P.prototype.when=function(){var t=Array.prototype.slice.call(arguments,0),e=t.length-1,i="function"!=typeof t[0]&&t.length>0?t.slice(0,Math.max(1,e)):[],n=t[e];if(0===i.length)throw new Error("must provide at least one variant");for(var r=0;r<i.length;r++)this._assignHandlerToVariant(i[r],n)},P.prototype.default=function(t,e){if(this._defaultVariant)throw new Error("must provide exactly one `default`");this._defaultVariant=this._assignHandlerToVariant(t,e)},P.prototype.run=function(){var t;this._validate(),this._variantHandlers[this._assignment.getVariant()]?t=this._variantHandlers[this._assignment.getVariant()]:(t=this._variantHandlers[this.getDefaultVariant()],this._defaulted=!0),t()},P.prototype.isDefaulted=function(){return this._defaulted||!1},P.prototype.getDefaultVariant=function(){return this._defaultVariant},P.prototype._assignHandlerToVariant=function(t,e){if("function"!=typeof e)throw new Error("must provide handler for "+t);return t=t.toString(),this._getSplit()&&!this._getSplit().hasVariant(t)&&this._visitor.logError("configures unknown variant "+t),this._variantHandlers[t]=e,t},P.prototype._validate=function(){if(!this.getDefaultVariant())throw new Error("must provide exactly one `default`");if(this._getVariants().length<2)throw new Error("must provide at least one `when`");if(this._getSplit()){var t=this._getMissingVariants();if(t.length>0){var e=t.join(", ").replace(/, (.+)$/," and $1");this._visitor.logError("does not configure variants "+e)}}},P.prototype._getSplit=function(){return this._splitRegistry.getSplit(this._assignment.getSplitName())},P.prototype._getVariants=function(){return Object.getOwnPropertyNames(this._variantHandlers)},P.prototype._getMissingVariants=function(){for(var t=this._getVariants(),e=this._getSplit().getVariants(),i=[],n=0;n<e.length;n++){var r=e[n];-1===t.indexOf(r)&&i.push(r)}return i};var F=function(t){if(t=t||{},this._id=t.id,this._assignments=t.assignments,this._ttOffline=t.ttOffline,!this._id)throw new Error("must provide id");if(!this._assignments)throw new Error("must provide assignments");this._errorLogger=function(t){window.console.error(t)},this.analytics=new b};F.loadVisitor=function(e){var i=t.Deferred(),r=function(t){i.resolve(new F(t))};return e?v()?r({id:e,assignments:v(),ttOffline:!1}):t.ajax(c()+"/api/v1/visitors/"+e,{method:"GET",timeout:5e3}).done(function(t){r({id:t.id,assignments:n.fromJsonArray(t.assignments),ttOffline:!1})}).fail(function(){r({id:e,assignments:[],ttOffline:!0})}):r({id:U.v4(),assignments:[],ttOffline:!1}),i.promise()},F.prototype.getId=function(){return this._id},F.prototype.getAssignmentRegistry=function(){if(!this._assignmentRegistry){for(var t={},e=0;e<this._assignments.length;e++){var i=this._assignments[e];t[i.getSplitName()]=i}this._assignmentRegistry=t}return this._assignmentRegistry},F.prototype.vary=function(t,e){if("object"!==y(e.variants))throw new Error("must provide variants object to `vary` for "+t);if(!e.context)throw new Error("must provide context to `vary` for "+t);if(!e.defaultVariant&&!1!==e.defaultVariant)throw new Error("must provide defaultVariant to `vary` for "+t);var i=e.defaultVariant.toString(),n=e.variants,r=e.context;if(!n.hasOwnProperty(i))throw new Error("defaultVariant: "+i+" must be represented in variants object");var s=this._getAssignmentFor(t,r),o=new P({assignment:s,visitor:this});for(var a in n)n.hasOwnProperty(a)&&(a===i?o.default(a,n[a]):o.when(a,n[a]));o.run(),o.isDefaulted()&&(s.setVariant(o.getDefaultVariant()),s.setUnsynced(!0),s.setContext(r)),this.notifyUnsyncedAssignments()},F.prototype.ab=function(t,e){var i=new _({splitName:t,trueVariant:e.trueVariant,visitor:this}).getVariants(),n={};n[i.true]=function(){e.callback(!0)},n[i.false]=function(){e.callback(!1)},this.vary(t,{context:e.context,variants:n,defaultVariant:i.false})},F.prototype.setErrorLogger=function(t){if("function"!=typeof t)throw new Error("must provide function for errorLogger");this._errorLogger=t},F.prototype.logError=function(t){this._errorLogger.call(null,t)},F.prototype.linkIdentifier=function(e,i){var n=t.Deferred();return new V({visitorId:this.getId(),identifierType:e,value:i}).save().then(function(t){this._merge(t),this.notifyUnsyncedAssignments(),n.resolve()}.bind(this)),n.promise()},F.prototype.setAnalytics=function(t){if("object"!==y(t))throw new Error("must provide object for setAnalytics");this.analytics=t},F.prototype.notifyUnsyncedAssignments=function(){for(var t=this._getUnsyncedAssignments(),e=0;e<t.length;e++)this._notify(t[e])},F.prototype._getUnsyncedAssignments=function(){var t=[],e=this.getAssignmentRegistry();return Object.keys(e).forEach(function(i){var n=e[i];n.isUnsynced()&&t.push(n)}),t},F.prototype._merge=function(t){var e=this.getAssignmentRegistry(),i=t.getAssignmentRegistry();for(var n in this._id=t.getId(),i)i.hasOwnProperty(n)&&(e[n]=i[n])},F.prototype._getAssignmentFor=function(t,e){return this.getAssignmentRegistry()[t]||this._generateAssignmentFor(t,e)},F.prototype._generateAssignmentFor=function(t,e){var i=new R({visitor:this,splitName:t}).getVariant();i||(this._ttOffline=!0);var r=new n({splitName:t,variant:i,context:e,isUnsynced:!0});return this._assignments.push(r),this._assignmentRegistry=null,r},F.prototype._notify=function(t){try{if(this._ttOffline)return;new w({visitor:this,assignment:t}).send(),t.setUnsynced(!1)}catch(t){this.logError("test_track notify error: "+t)}};var H=function(){this._visitorDeferred=t.Deferred()};H.prototype.initialize=function(e){var i=t.cookie(g());return this._visitorDeferred.then(function(t){t.notifyUnsyncedAssignments()}),F.loadVisitor(i).then(function(t){e&&e.analytics&&t.setAnalytics(e.analytics),e&&e.errorLogger&&t.setErrorLogger(e.errorLogger),e&&"function"==typeof e.onVisitorLoaded&&e.onVisitorLoaded.call(null,t),this._visitorDeferred.resolve(t)}.bind(this)),this._setCookie(),this._visitorDeferred.promise()},H.prototype.vary=function(t,e){this._visitorDeferred.then(function(i){i.vary(t,e)})},H.prototype.ab=function(t,e){this._visitorDeferred.then(function(i){i.ab(t,e)})},H.prototype.logIn=function(e,i){var n=t.Deferred();return this._visitorDeferred.then(function(t){t.linkIdentifier(e,i).then(function(){this._setCookie(),t.analytics.identify(t.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},H.prototype.signUp=function(e,i){var n=t.Deferred();return this._visitorDeferred.then(function(t){t.linkIdentifier(e,i).then(function(){this._setCookie(),t.analytics.alias(t.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},H.prototype._setCookie=function(){this._visitorDeferred.then(function(e){t.cookie(g(),e.getId(),{expires:365,path:"/",domain:d()})})},H.prototype.getPublicAPI=function(){return{vary:this.vary.bind(this),ab:this.ab.bind(this),logIn:this.logIn.bind(this),signUp:this.signUp.bind(this),initialize:this.initialize.bind(this),_crx:{loadInfo:function(){var e=t.Deferred();return this._visitorDeferred.then(function(t){var i={};for(var n in t.getAssignmentRegistry())i[n]=t.getAssignmentRegistry()[n].getVariant();e.resolve({visitorId:t.getId(),splitRegistry:l().asV1Hash(),assignmentRegistry:i})}),e.promise()}.bind(this),persistAssignment:function(e,i,r,s){var o=t.Deferred();return this._visitorDeferred.then(function(t){new m({visitor:t,username:r,password:s,assignment:new n({splitName:e,variant:i,context:"chrome_extension",isUnsynced:!0})}).persistAssignment().then(function(){o.resolve()})}),o.promise()}.bind(this)}}};var L=(new H).getPublicAPI(),J=function(){window.dispatchEvent(new CustomEvent("tt:lib:loaded",{detail:{TestTrack:L}}))};try{t(document).ready(function(){t(document.body).addClass("_tt");try{window.dispatchEvent(new CustomEvent("tt:class:added"))}catch(t){}}),J(),window.addEventListener("tt:listener:ready",J)}catch(t){}return L});
