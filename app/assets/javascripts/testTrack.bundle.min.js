!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t=t||self).TestTrack=e(t.$)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(t,e){return t(e={exports:{}},e.exports),e.exports}var n=i(function(t,e){var i;i=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}return function e(i){function n(e,r,s){var o;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(s=t({path:"/"},n.defaults,s)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*s.expires),s.expires=a}s.expires=s.expires?s.expires.toUTCString():"";try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(t){}r=i.write?i.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var u="";for(var f in s)s[f]&&(u+="; "+f,!0!==s[f]&&(u+="="+s[f]));return document.cookie=e+"="+r+u}e||(o={});for(var p=document.cookie?document.cookie.split("; "):[],h=/(%[0-9A-Z]{2})+/g,c=0;c<p.length;c++){var d=p[c].split("="),g=d.slice(1).join("=");this.json||'"'!==g.charAt(0)||(g=g.slice(1,-1));try{var l=d[0].replace(h,decodeURIComponent);if(g=i.read?i.read(g,l):i(g,l)||g.replace(h,decodeURIComponent),this.json)try{g=JSON.parse(g)}catch(t){}if(e===l){o=g;break}e||(o[l]=g)}catch(t){}}return o}}return n.set=n,n.get=function(t){return n.call(n,t)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(e,i){n(e,"",t(i,{expires:-1}))},n.withConverter=e,n}(function(){})},t.exports=i()}),r=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("variant"))throw new Error("must provide variant");if(!t.hasOwnProperty("isUnsynced"))throw new Error("must provide isUnsynced");this._splitName=t.splitName,this._variant=t.variant,this._context=t.context,this._isUnsynced=t.isUnsynced};r.fromJsonArray=function(t){for(var e=[],i=0;i<t.length;i++)e.push(new r({splitName:t[i].split_name,variant:t[i].variant,context:t[i].context,isUnsynced:t[i].unsynced}));return e},r.prototype.getSplitName=function(){return this._splitName},r.prototype.getVariant=function(){return this._variant},r.prototype.setVariant=function(t){this._variant=t},r.prototype.getContext=function(){return this._context},r.prototype.setContext=function(t){this._context=t},r.prototype.isUnsynced=function(){return this._isUnsynced},r.prototype.setUnsynced=function(t){this._isUnsynced=t};var s=i(function(t,i){!function(n){var r=i,s=t&&t.exports==r&&t,o="object"==typeof e&&e;o.global!==o&&o.window!==o||(n=o);var a=function(t){this.message=t};(a.prototype=new Error).name="InvalidCharacterError";var u=function(t){throw new a(t)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=/[\t\n\f\r ]/g,h={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var e,i,n,r,s=t.length%3,o="",a=-1,p=t.length-s;++a<p;)e=t.charCodeAt(a)<<16,i=t.charCodeAt(++a)<<8,n=t.charCodeAt(++a),o+=f.charAt((r=e+i+n)>>18&63)+f.charAt(r>>12&63)+f.charAt(r>>6&63)+f.charAt(63&r);return 2==s?(e=t.charCodeAt(a)<<8,i=t.charCodeAt(++a),o+=f.charAt((r=e+i)>>10)+f.charAt(r>>4&63)+f.charAt(r<<2&63)+"="):1==s&&(r=t.charCodeAt(a),o+=f.charAt(r>>2)+f.charAt(r<<4&63)+"=="),o},decode:function(t){var e=(t=String(t).replace(p,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9\/]/.test(t))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var i,n,r=0,s="",o=-1;++o<e;)n=f.indexOf(t.charAt(o)),i=r%4?64*i+n:n,r++%4&&(s+=String.fromCharCode(255&i>>(-2*r&6)));return s},version:"0.1.0"};if(r&&!r.nodeType)if(s)s.exports=h;else for(var c in h)h.hasOwnProperty(c)&&(r[c]=h[c]);else n.base64=h}(e)}),o=function(){};o.prototype.getConfig=function(){return"function"==typeof window.atob?JSON.parse(window.atob(window.TT)):JSON.parse(s.decode(window.TT))};var a=function(t,e,i){this._name=t,this._isFeatureGate=e,this._weighting=i};a.prototype.getName=function(){return this._name},a.prototype.isFeatureGate=function(){return this._isFeatureGate},a.prototype.getVariants=function(){return Object.keys(this._weighting)},a.prototype.getWeighting=function(){return this._weighting},a.prototype.hasVariant=function(t){return t in this._weighting};var u=function(t){this._splitArray=t,this._loaded=null!==t};u.prototype.getSplit=function(t){return this.getSplits()[t]},u.prototype.isLoaded=function(){return this._loaded},u.prototype.asV1Hash=function(){var t={};for(var e in this.getSplits()){var i=this._splits[e];t[e]=i.getWeighting()}return t},u.prototype.getSplits=function(){return this._loaded?(this._splits||(this._splits={},this._splitArray.forEach(function(t){this._splits[t.getName()]=t}.bind(this))),this._splits):{}};var f,p,h,c=function(){if(!f){var t=new o;f=t.getConfig()}return f},d=function(){return c().url},g=function(){return c().cookieDomain},l=function(){return c().cookieName||"tt_visitor_id"},v=function(){var t=c().splits;if(!t)return new u(null);if(!h){var e=Object.keys(t).map(function(e){var i=t[e];return new a(e,i.feature_gate,i.weights)});h=new u(e)}return h},m=function(){var t=c().assignments;if(!t)return null;if(!p)for(var e in p=[],t)p.push(new r({splitName:e,variant:t[e],isUnsynced:!1}));return p},y=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,this._username=t.username,this._password=t.password,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment");if(!this._username)throw new Error("must provide username");if(!this._password)throw new Error("must provide password")};function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}y.prototype.persistAssignment=function(){return t.ajax(d()+"/api/v1/assignment_override",{method:"POST",dataType:"json",crossDomain:!0,headers:{Authorization:"Basic "+btoa(this._username+":"+this._password)},data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),variant:this._assignment.getVariant(),context:this._assignment.getContext(),mixpanel_result:"success"}}).fail(function(t,e,i){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,e,i].join(", "))}.bind(this))};var w=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("trueVariant"))throw new Error("must provide trueVariant");if(!t.visitor)throw new Error("must provide visitor");this._splitName=t.splitName,this._trueVariant=t.trueVariant,this._visitor=t.visitor,this._splitRegistry=v()};w.prototype.getVariants=function(){var t=this._getSplitVariants();return t&&t.length>2&&this._visitor.logError("A/B for "+this._splitName+" configures split with more than 2 variants"),{true:this._getTrueVariant(),false:this._getFalseVariant()}},w.prototype._getTrueVariant=function(){return this._trueVariant||!0},w.prototype._getFalseVariant=function(){var t=this._getNonTrueVariants();return!!t&&t.sort()[0]},w.prototype._getNonTrueVariants=function(){var t=this._getSplitVariants();if(t){var e=this._getTrueVariant(),i=t.indexOf(e);return-1!==i&&t.splice(i,1),t}return null},w.prototype._getSplit=function(){return this._splitRegistry.getSplit(this._splitName)},w.prototype._getSplitVariants=function(){return this._getSplit()&&this._getSplit().getVariants()};var V=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment")};V.prototype.send=function(){var e=this._persistAssignment(),i=t.Deferred();return this._visitor.analytics.trackAssignment(this._visitor.getId(),this._assignment,function(t){var e=this._persistAssignment(t?"success":"failure");e.always(function(){"resolved"===e.state()?i.resolve():i.reject()})}.bind(this)),t.when(e,i)},V.prototype._persistAssignment=function(e){return t.ajax(d()+"/api/v1/assignment_event",{method:"POST",dataType:"json",crossDomain:!0,data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),context:this._assignment.getContext(),mixpanel_result:e}}).fail(function(t,e,i){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,e,i].join(", "))}.bind(this))};var A=function(t){if(this.visitorId=t.visitorId,this.identifierType=t.identifierType,this.value=t.value,!this.visitorId)throw new Error("must provide visitorId");if(!this.identifierType)throw new Error("must provide identifierType");if(!this.value)throw new Error("must provide value")};A.prototype.save=function(){var e=t.Deferred();return t.ajax(d()+"/api/v1/identifier",{method:"POST",dataType:"json",crossDomain:!0,data:{identifier_type:this.identifierType,value:this.value,visitor_id:this.visitorId}}).then(function(t){var i=new O({id:t.visitor.id,assignments:r.fromJsonArray(t.visitor.assignments)});e.resolve(i)}),e.promise()};var b=function(){};b.prototype.trackAssignment=function(t,e,i){var n={TTVisitorID:t,SplitName:e.getSplitName(),SplitVariant:e.getVariant(),SplitContext:e.getContext()};window.mixpanel&&window.mixpanel.track("SplitAssigned",n,i)},b.prototype.identify=function(t){window.mixpanel&&window.mixpanel.identify(t)},b.prototype.alias=function(t){window.mixpanel&&window.mixpanel.alias(t)};for(var x=i(function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var i=new Uint8Array(16);t.exports=function(){return e(i),i}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}}),E=[],S=0;S<256;++S)E[S]=(S+256).toString(16).substr(1);var C=function(t,e){var i=e||0,n=E;return[n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],"-",n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]],n[t[i++]]].join("")};var N=function(t,e,i){var n=e&&i||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var r=(t=t||{}).random||(t.rng||x)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var s=0;s<16;++s)e[n+s]=r[s];return e||C(r)},I=i(function(t){!function(e){function i(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function n(t,e,n,r,s,o){return i((a=i(i(e,t),i(r,o)))<<(u=s)|a>>>32-u,n);var a,u}function r(t,e,i,r,s,o,a){return n(e&i|~e&r,t,e,s,o,a)}function s(t,e,i,r,s,o,a){return n(e&r|i&~r,t,e,s,o,a)}function o(t,e,i,r,s,o,a){return n(e^i^r,t,e,s,o,a)}function a(t,e,i,r,s,o,a){return n(i^(e|~r),t,e,s,o,a)}function u(t,e){var n,u,f,p,h;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var c=1732584193,d=-271733879,g=-1732584194,l=271733878;for(n=0;n<t.length;n+=16)u=c,f=d,p=g,h=l,c=r(c,d,g,l,t[n],7,-680876936),l=r(l,c,d,g,t[n+1],12,-389564586),g=r(g,l,c,d,t[n+2],17,606105819),d=r(d,g,l,c,t[n+3],22,-1044525330),c=r(c,d,g,l,t[n+4],7,-176418897),l=r(l,c,d,g,t[n+5],12,1200080426),g=r(g,l,c,d,t[n+6],17,-1473231341),d=r(d,g,l,c,t[n+7],22,-45705983),c=r(c,d,g,l,t[n+8],7,1770035416),l=r(l,c,d,g,t[n+9],12,-1958414417),g=r(g,l,c,d,t[n+10],17,-42063),d=r(d,g,l,c,t[n+11],22,-1990404162),c=r(c,d,g,l,t[n+12],7,1804603682),l=r(l,c,d,g,t[n+13],12,-40341101),g=r(g,l,c,d,t[n+14],17,-1502002290),c=s(c,d=r(d,g,l,c,t[n+15],22,1236535329),g,l,t[n+1],5,-165796510),l=s(l,c,d,g,t[n+6],9,-1069501632),g=s(g,l,c,d,t[n+11],14,643717713),d=s(d,g,l,c,t[n],20,-373897302),c=s(c,d,g,l,t[n+5],5,-701558691),l=s(l,c,d,g,t[n+10],9,38016083),g=s(g,l,c,d,t[n+15],14,-660478335),d=s(d,g,l,c,t[n+4],20,-405537848),c=s(c,d,g,l,t[n+9],5,568446438),l=s(l,c,d,g,t[n+14],9,-1019803690),g=s(g,l,c,d,t[n+3],14,-187363961),d=s(d,g,l,c,t[n+8],20,1163531501),c=s(c,d,g,l,t[n+13],5,-1444681467),l=s(l,c,d,g,t[n+2],9,-51403784),g=s(g,l,c,d,t[n+7],14,1735328473),c=o(c,d=s(d,g,l,c,t[n+12],20,-1926607734),g,l,t[n+5],4,-378558),l=o(l,c,d,g,t[n+8],11,-2022574463),g=o(g,l,c,d,t[n+11],16,1839030562),d=o(d,g,l,c,t[n+14],23,-35309556),c=o(c,d,g,l,t[n+1],4,-1530992060),l=o(l,c,d,g,t[n+4],11,1272893353),g=o(g,l,c,d,t[n+7],16,-155497632),d=o(d,g,l,c,t[n+10],23,-1094730640),c=o(c,d,g,l,t[n+13],4,681279174),l=o(l,c,d,g,t[n],11,-358537222),g=o(g,l,c,d,t[n+3],16,-722521979),d=o(d,g,l,c,t[n+6],23,76029189),c=o(c,d,g,l,t[n+9],4,-640364487),l=o(l,c,d,g,t[n+12],11,-421815835),g=o(g,l,c,d,t[n+15],16,530742520),c=a(c,d=o(d,g,l,c,t[n+2],23,-995338651),g,l,t[n],6,-198630844),l=a(l,c,d,g,t[n+7],10,1126891415),g=a(g,l,c,d,t[n+14],15,-1416354905),d=a(d,g,l,c,t[n+5],21,-57434055),c=a(c,d,g,l,t[n+12],6,1700485571),l=a(l,c,d,g,t[n+3],10,-1894986606),g=a(g,l,c,d,t[n+10],15,-1051523),d=a(d,g,l,c,t[n+1],21,-2054922799),c=a(c,d,g,l,t[n+8],6,1873313359),l=a(l,c,d,g,t[n+15],10,-30611744),g=a(g,l,c,d,t[n+6],15,-1560198380),d=a(d,g,l,c,t[n+13],21,1309151649),c=a(c,d,g,l,t[n+4],6,-145523070),l=a(l,c,d,g,t[n+11],10,-1120210379),g=a(g,l,c,d,t[n+2],15,718787259),d=a(d,g,l,c,t[n+9],21,-343485551),c=i(c,u),d=i(d,f),g=i(g,p),l=i(l,h);return[c,d,g,l]}function f(t){var e,i="",n=32*t.length;for(e=0;e<n;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function p(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;var n=8*t.length;for(e=0;e<n;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function h(t){var e,i,n="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),n+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return n}function c(t){return unescape(encodeURIComponent(t))}function d(t){return function(t){return f(u(p(t),8*t.length))}(c(t))}function g(t,e){return function(t,e){var i,n,r=p(t),s=[],o=[];for(s[15]=o[15]=void 0,r.length>16&&(r=u(r,8*t.length)),i=0;i<16;i+=1)s[i]=909522486^r[i],o[i]=1549556828^r[i];return n=u(s.concat(p(e)),512+8*e.length),f(u(o.concat(n),640))}(c(t),c(e))}function l(t,e,i){return e?i?g(e,t):h(g(e,t)):i?d(t):h(d(t))}t.exports?t.exports=l:e.md5=l}(e)}),T=function(t){if(this.visitor=t.visitor,this.splitName=t.splitName,!this.visitor)throw new Error("must provide visitor");if(!this.splitName)throw new Error("must provide splitName")};T.prototype.getVariant=function(){if(!v().isLoaded())return null;for(var t=0,e=this.getAssignmentBucket(),i=this.getWeighting(),n=this.getSortedVariants(),r=0;r<n.length;r++){var s=n[r];if((t+=i[s])>e)return s}throw new Error("Assignment bucket out of range. "+e+" unmatched in "+this.splitName+": "+JSON.stringify(i))},T.prototype.getSplitVisitorHash=function(){return I(this.splitName+this.visitor.getId())},T.prototype.getHashFixnum=function(){return parseInt(this.getSplitVisitorHash().substr(0,8),16)},T.prototype.getAssignmentBucket=function(){return this.getHashFixnum()%100},T.prototype.getSortedVariants=function(){return this.getVariants().sort()},T.prototype.getVariants=function(){return Object.getOwnPropertyNames(this.getWeighting())},T.prototype.getWeighting=function(){var t=v().getSplit(this.splitName);if(!t){var e='Unknown split: "'+this.splitName+'"';throw this.visitor.logError(e),new Error(e)}return t.getWeighting()};var D=function(t){if(!t.assignment)throw new Error("must provide assignment");if(!t.visitor)throw new Error("must provide visitor");this._assignment=t.assignment,this._visitor=t.visitor,this._splitRegistry=v(),this._variantHandlers={}};D.prototype.when=function(){var t=Array.prototype.slice.call(arguments,0),e=t.length-1,i="function"!=typeof t[0]&&t.length>0?t.slice(0,Math.max(1,e)):[],n=t[e];if(0===i.length)throw new Error("must provide at least one variant");for(var r=0;r<i.length;r++)this._assignHandlerToVariant(i[r],n)},D.prototype.default=function(t,e){if(this._defaultVariant)throw new Error("must provide exactly one `default`");this._defaultVariant=this._assignHandlerToVariant(t,e)},D.prototype.run=function(){var t;this._validate(),this._variantHandlers[this._assignment.getVariant()]?t=this._variantHandlers[this._assignment.getVariant()]:(t=this._variantHandlers[this.getDefaultVariant()],this._defaulted=!0),t()},D.prototype.isDefaulted=function(){return this._defaulted||!1},D.prototype.getDefaultVariant=function(){return this._defaultVariant},D.prototype._assignHandlerToVariant=function(t,e){if("function"!=typeof e)throw new Error("must provide handler for "+t);return t=t.toString(),this._getSplit()&&!this._getSplit().hasVariant(t)&&this._visitor.logError("configures unknown variant "+t),this._variantHandlers[t]=e,t},D.prototype._validate=function(){if(!this.getDefaultVariant())throw new Error("must provide exactly one `default`");if(this._getVariants().length<2)throw new Error("must provide at least one `when`");if(this._getSplit()){var t=this._getMissingVariants();if(t.length>0){var e=t.join(", ").replace(/, (.+)$/," and $1");this._visitor.logError("does not configure variants "+e)}}},D.prototype._getSplit=function(){return this._splitRegistry.getSplit(this._assignment.getSplitName())},D.prototype._getVariants=function(){return Object.getOwnPropertyNames(this._variantHandlers)},D.prototype._getMissingVariants=function(){for(var t=this._getVariants(),e=this._getSplit().getVariants(),i=[],n=0;n<e.length;n++){var r=e[n];-1===t.indexOf(r)&&i.push(r)}return i};var O=function(t){if(t=t||{},this._id=t.id,this._assignments=t.assignments,this._ttOffline=t.ttOffline,!this._id)throw new Error("must provide id");if(!this._assignments)throw new Error("must provide assignments");this._errorLogger=function(t){window.console.error(t)},this.analytics=new b};O.loadVisitor=function(e){var i=t.Deferred(),n=function(t){i.resolve(new O(t))};return e?m()?n({id:e,assignments:m(),ttOffline:!1}):t.ajax(d()+"/api/v1/visitors/"+e,{method:"GET",timeout:5e3}).done(function(t){n({id:t.id,assignments:r.fromJsonArray(t.assignments),ttOffline:!1})}).fail(function(){n({id:e,assignments:[],ttOffline:!0})}):n({id:N(),assignments:[],ttOffline:!1}),i.promise()},O.prototype.getId=function(){return this._id},O.prototype.getAssignmentRegistry=function(){if(!this._assignmentRegistry){for(var t={},e=0;e<this._assignments.length;e++){var i=this._assignments[e];t[i.getSplitName()]=i}this._assignmentRegistry=t}return this._assignmentRegistry},O.prototype.vary=function(t,e){if("object"!==_(e.variants))throw new Error("must provide variants object to `vary` for "+t);if(!e.context)throw new Error("must provide context to `vary` for "+t);if(!e.defaultVariant&&!1!==e.defaultVariant)throw new Error("must provide defaultVariant to `vary` for "+t);var i=e.defaultVariant.toString(),n=e.variants,r=e.context;if(!n.hasOwnProperty(i))throw new Error("defaultVariant: "+i+" must be represented in variants object");var s=this._getAssignmentFor(t,r),o=new D({assignment:s,visitor:this});for(var a in n)n.hasOwnProperty(a)&&(a===i?o.default(a,n[a]):o.when(a,n[a]));o.run(),o.isDefaulted()&&(s.setVariant(o.getDefaultVariant()),s.setUnsynced(!0),s.setContext(r)),this.notifyUnsyncedAssignments()},O.prototype.ab=function(t,e){var i=new w({splitName:t,trueVariant:e.trueVariant,visitor:this}).getVariants(),n={};n[i.true]=function(){e.callback(!0)},n[i.false]=function(){e.callback(!1)},this.vary(t,{context:e.context,variants:n,defaultVariant:i.false})},O.prototype.setErrorLogger=function(t){if("function"!=typeof t)throw new Error("must provide function for errorLogger");this._errorLogger=t},O.prototype.logError=function(t){this._errorLogger.call(null,t)},O.prototype.linkIdentifier=function(e,i){var n=t.Deferred();return new A({visitorId:this.getId(),identifierType:e,value:i}).save().then(function(t){this._merge(t),this.notifyUnsyncedAssignments(),n.resolve()}.bind(this)),n.promise()},O.prototype.setAnalytics=function(t){if("object"!==_(t))throw new Error("must provide object for setAnalytics");this.analytics=t},O.prototype.notifyUnsyncedAssignments=function(){for(var t=this._getUnsyncedAssignments(),e=0;e<t.length;e++)this._notify(t[e])},O.prototype._getUnsyncedAssignments=function(){var t=[],e=this.getAssignmentRegistry();return Object.keys(e).forEach(function(i){var n=e[i];n.isUnsynced()&&t.push(n)}),t},O.prototype._merge=function(t){var e=this.getAssignmentRegistry(),i=t.getAssignmentRegistry();for(var n in this._id=t.getId(),i)i.hasOwnProperty(n)&&(e[n]=i[n])},O.prototype._getAssignmentFor=function(t,e){return this.getAssignmentRegistry()[t]||this._generateAssignmentFor(t,e)},O.prototype._generateAssignmentFor=function(t,e){var i=new T({visitor:this,splitName:t}).getVariant();i||(this._ttOffline=!0);var n=new r({splitName:t,variant:i,context:e,isUnsynced:!0});return this._assignments.push(n),this._assignmentRegistry=null,n},O.prototype._notify=function(t){try{if(this._ttOffline)return;new V({visitor:this,assignment:t}).send(),t.setUnsynced(!1)}catch(t){this.logError("test_track notify error: "+t)}};var U=function(){this._visitorDeferred=t.Deferred()};U.prototype.initialize=function(t){var e=n.get(l());return this._visitorDeferred.then(function(t){t.notifyUnsyncedAssignments()}),O.loadVisitor(e).then(function(e){t&&t.analytics&&e.setAnalytics(t.analytics),t&&t.errorLogger&&e.setErrorLogger(t.errorLogger),t&&"function"==typeof t.onVisitorLoaded&&t.onVisitorLoaded.call(null,e),this._visitorDeferred.resolve(e)}.bind(this)),this._setCookie(),this._visitorDeferred.promise()},U.prototype.vary=function(t,e){this._visitorDeferred.then(function(i){i.vary(t,e)})},U.prototype.ab=function(t,e){this._visitorDeferred.then(function(i){i.ab(t,e)})},U.prototype.logIn=function(e,i){var n=t.Deferred();return this._visitorDeferred.then(function(t){t.linkIdentifier(e,i).then(function(){this._setCookie(),t.analytics.identify(t.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},U.prototype.signUp=function(e,i){var n=t.Deferred();return this._visitorDeferred.then(function(t){t.linkIdentifier(e,i).then(function(){this._setCookie(),t.analytics.alias(t.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},U.prototype._setCookie=function(){this._visitorDeferred.then(function(t){n.set(l(),t.getId(),{expires:365,path:"/",domain:g()})})},U.prototype.getPublicAPI=function(){return{vary:this.vary.bind(this),ab:this.ab.bind(this),logIn:this.logIn.bind(this),signUp:this.signUp.bind(this),initialize:this.initialize.bind(this),_crx:{loadInfo:function(){var e=t.Deferred();return this._visitorDeferred.then(function(t){var i={};for(var n in t.getAssignmentRegistry())i[n]=t.getAssignmentRegistry()[n].getVariant();e.resolve({visitorId:t.getId(),splitRegistry:v().asV1Hash(),assignmentRegistry:i})}),e.promise()}.bind(this),persistAssignment:function(e,i,n,s){var o=t.Deferred();return this._visitorDeferred.then(function(t){new y({visitor:t,username:n,password:s,assignment:new r({splitName:e,variant:i,context:"chrome_extension",isUnsynced:!0})}).persistAssignment().then(function(){o.resolve()})}),o.promise()}.bind(this)}}};var k=(new U).getPublicAPI(),j=function(){window.dispatchEvent(new CustomEvent("tt:lib:loaded",{detail:{TestTrack:k}}))};try{t(document).ready(function(){t(document.body).addClass("_tt");try{window.dispatchEvent(new CustomEvent("tt:class:added"))}catch(t){}}),j(),window.addEventListener("tt:listener:ready",j)}catch(t){}return k});
